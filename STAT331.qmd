---
title: "STAT 331 Group Project"
subtitle: "Analyzing the Effect of Health Spending on Life Expectancy"
authors: "Gracie, Ana√Øs, Kyle, Ryan"
format: 
  html:
    embed-resources: true
    code-tools: true
    toc: true
    number-sections: true
    code-fold: true
editor: source
execute: 
  error: true
  echo: true
  message: false
  warning: false
---
# Project Proposal and Data

The United States is infamous for its exceptionally high healthcare costs, but does this substantial spending translate to longer lifespans? By examining total healthcare expenditure per person (in US dollars) across 188 countries, we aim to uncover its impact on life expectancy.

## Importing Libraries
```{r}
library(tidyverse)
library(dplyr)
library(ggplot2)
library(knitr)
library(kableExtra)
library(ggpmisc)
```

## Importing the Datasets 
```{r}
life <- read_csv("data/lex.csv")
health <- read_csv("data/total_health_spending_per_person_us.csv")

```

## Data Description 
For this data, countries are defined as boundaries as of current geographic boundaries, world history is also shown as if country borders had always been the same as current boundaries. 

*Total health spending per person in US$* 

This data set ranges from the time period 1995-2010 and shows the average health expenditure per person, expressed in US dollars using the average exchange rate. These values are determined by the World Health Organization (WHO). An average exchange rate is a way to convert from foreign currency to US dollars by dividing the foreign currency amount by an applicable yearly average exchange rate developed by the IRS.
Source: https://www.gapminder.org/data/ 

*Life expectancy, at birth*

This data ranges from a time period of 1800-2100 with the future years being forecasts calculated by the UN. From the years 1800-1970, the main source of this data is from Mattias Lindgen and Klara Johansson. From 1950-2019 the main source of this data is from Institute for Health Metrics and Evaluation (IHME). Life expectancy is defined as the number of years a newborn infant would live if the current mortality rates at different ages were constant. We used the most recent version available to us, Version 14, which was last updated on October 10th 2017. 
Source: https://www.gapminder.org/data/ 


## Hypothesis 
We hypothesize that higher spending on health will increase life expectancy. Past research conducted on similar topics have shown that increases in healthcare related social policies have increased life expectancy in the United States (Reynolds, 2019). Applying these same principles to the aforementioned variables, we believe that increased funding leads to increased life span.
Source: https://pmc.ncbi.nlm.nih.gov/articles/PMC5739520/ 


## Cleaning the Data
First, we focused on narrowing down the life expectancy dataset to the years that overlap with the total health spending per person data set (1995 to 2010). Similarly, our next focus was to narrow down the list of countries to those provided in the total health spending per person data set. Doing so revealed a list of 188 of countries across Europe, Africa, and the Americas. This dataset has 32 missing values all in the spending column of our data set, which we labeled as N/A. Luckily, both datasets were consistently formatted in dollars and years, so no adjustment was needed in this regard.

```{r}
life_exptcy <- life |> 
   select("country", 197:212) |> 
    pivot_longer(cols = !country, 
               names_to = "Year",
               values_to = "Life Expectancy") |>
  rename(Country = country)

health_spd <- health|>
      pivot_longer(cols = !country, 
               names_to = "Year",
               values_to = "Spending") |>
   rename(Country = country)
```

## Joining the Datasets
```{r}
data <- inner_join(life_exptcy, health_spd,
                   by = join_by(Country,Year))
head(data) |>
  kable(
      col.names = c("Country", "Year", "Life Expectancy", "Health Spending"),
      caption = "Life Expectancy and Health Spending by Country and Year") |>
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) |>
  column_spec(1, bold = TRUE)

```

## Total Number of Countries
```{r}
country_count <- data |> 
summarize(Number_of_Countries = n_distinct(Country))
  kable(country_count)
```

## Number of Missing Data
```{r}
missing_values <- data |> 
  summarize(across(everything(), ~sum(is.na(.x))))
kable(missing_values)
```

# Linear Regression

In this section we hope to visualize the relationship between the two variables of interest and use a linear regression to model this relationship for further analysis. To do so, the total health spending per person will be our independent variable as we are looking to understand the impact of this variable on life expectancy. 

## Data Visualization 1 - The Effect of Health Spending on Life Expectancy

The plot below shows the relationship between Total Health Spending per person in US Dollars and Life Expectancy expressed in years. 
```{r}
ggplot(data = data,
           aes(x = Spending, y = `Life Expectancy`)) + 
      geom_point(color = "steelblue", alpha = 0.6) + 
      labs(x = "Spending (in USD)",
           y = "Life Expectancy (in Years)",
           title = "The Effect of Health Spending on Life Expectancy") +
  theme_minimal()
```
The graph above shows how the plots are mostly concentrated on the left side of the graph. This indicates that the majority of the data shows a lower amount of spending on health care. In addition, it can also be seen that with a lower amount of spending, less than 1000 USD, there is a small number of observations where the life expectancy reaches above 80 years old and majority of the observations fall into the range of 40 to 75 years old. On the other hand, as the spending increases, so does the amount of observations with a recorded life expectancy above 80 years old. An inference could be made stating that with a smaller amount of spending a country dedicates towards healthcare, the lower the expected life expectancy could be. 


## Data Visualization 2 - Average Health Spending vs Life Expectancy Over Time

The following plot analyzes the relationship between the Average Total Health Spending and Average Life Expectancy over time, highlighting how changes in healthcare investment correlate with improvements in longevity. By aggregating data across all countries, this visualization provides a clearer picture of global trends, reducing noise from individual country variations.

```{r}
summary_data <- data |>
  group_by(Year) |>
  summarize(mean_spending = mean(Spending, na.rm = TRUE),
            mean_life_expectancy = mean(`Life Expectancy`, na.rm = TRUE))
            
ggplot(summary_data, 
       aes(x = mean_spending, 
           y = mean_life_expectancy)) + 
  geom_line(color = "steelblue", size = 1) + 
  labs(x = "Average Health Spending (in USD)", 
       y = "Average Life Expectancy (in Years)",
       title = "Average Health Spending vs Life Expectancy Over Time") +
  theme_minimal()
```
The above figure shows an overall positive relationship between the average amount of health spending and average life expectancy. Compared to the first graph, the range for life expectancy and spending is not as large, given that the averages were taken, rather than individual countries and individual years. From this figure, the inference could be made that with a lower amount of spending, the lower the average life expectancy and with the higher amount of spending, the higher the life expectancy. However, this also raises the question of if health spending is increasing because the population already has a high life expectancy (with a longer lifespan there are more opportunities for health spending). 

## Linear Regression Model
The data we used to fit the linear model comes from averaging the health spending and life expectancy across all years for each country. This allows us to compare individual countries so we can look for any trends between countries while reducing complexity and volume of data points.

This linear regression model models the relationship between life expectancy and the logarithm of health spending. The plot, pre-transformation of the explanatory variable, showed a logarithmic curve. To linearize the data, we had to perform a logarithmic transformation on the explanatory variable, average health spending.
```{r}
summarized_country <- data |>
  group_by(Country) |>
  summarize(mean_spending = mean(Spending, na.rm = TRUE),
            mean_life_expectancy = mean(`Life Expectancy`, na.rm = TRUE))

summarized_country |>
  ggplot(mapping = aes(x = log(mean_spending),
                       y = mean_life_expectancy)) +
  geom_jitter() +
  geom_smooth(method = "lm") + 
  
  stat_poly_eq(
    aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")),
    formula = y ~ x, 
    parse = TRUE
  ) +
  
  labs(x = "Average Health Spending (USD)", y = "Average Life Expectancy (years)")

life_exptcy_lm <- lm(mean_life_expectancy ~ log(mean_spending),
                     data = summarized_country)
summary(life_exptcy_lm)
```
With the equation y = 46.3 + 4.25x and with x being the independent variables and y representing the dependent variables, this equation can help predict the average life expectancy with the average spending amount. 46.3 in the equation represents the average health expectancy if the health spending were 0 USD. The 4.25 is the predicted change in average life expectancy for every USD increase in average spending. The R^2 value shows that 63% of the variation in average life expectancy can be explained by the average health spending. 


